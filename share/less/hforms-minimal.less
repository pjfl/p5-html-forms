/* @author  pjfl@cpan.org (Peter Flanigan)
 * @version 0.1.98
 * Colours */
@button-border: gainsboro;
@checkbox-bg-false: firebrick;
@checkbox-bg-true: seagreen;
@exception-bg: lightpink;
@field-focus-outline: darkorange;
@field-required: firebrick;
@form-bg-border-focus: seagreen;
@input-border: gainsboro;
@line-border: gray;
@panel-shadow: gray;
@text-close: firebrick;

@text-dark: black;
@text-disabled: gray;
@text-doc-punc: sienna;
@text-link: seagreen;
@text-watermark: gray;

@text-light: whitesmoke;
@text-disabled-light: gainsboro;
@text-link-light: cornsilk;
@text-watermark-light: ivory;

/* Dimensions */
@alert-min-width: 10rem;
@alert-max-width: 18rem;

@checkbox-height: 1.25rem;
@checkbox-width: 40px;
@checkbox-width-knob: 20px;

@display-text-min-width: 10rem;
@display-text-max-width: 20rem;

@ds-form-max-height-vertical: 60vh;
@ds-form-max-width-horizontal: 21rem;

@error-max-width: 50rem;

@field-min-width: 13rem;
@field-row-gap: 0.5rem;
@field-col-gap: 0.5rem;

@filemanager-min-width: 10rem;

@form-min-width: 15rem;
@form-max-width: 60rem;

@input-min-width: 4rem;
@input-max-width: 24rem;
@input-max-width-compound: 12rem;

@label-width-base: 2.5rem;
@label-width-tiny: 3rem;
@label-width-narrow: (@label-width-base + @label-width-tiny);
@label-width: (@label-width-tiny + @label-width-narrow);
@label-width-wide: (@label-width-narrow + @label-width);

@select-min-width: 4rem;
@select-max-width: 12rem;
@select-option-min-width: 8rem;

@selector-min-width: 16rem;

@tile-min-width: 8ch;

@textarea-min-height: 3lh;
@textarea-min-width: 18rem;
@textarea-max-width: 40rem;

/* Font Sizes and Weights */
@button-font-size: 0.7rem;
@button-font-weight: 410;
@data-font-size: 0.8rem;
@data-font-weight: normal;
@system-font-size: 0.8rem;
@title-font-size: 1rem;
@title-font-weight: normal;

#fonts() {
    cursive: 'Segoe Print', 'Bradley Hand', 'Chilanka', casual, cursive;
    mono: 'Cascadia Code', 'Menlo', 'DejaVu Sans Mono', ui-monospace, monospace;
    sans: 'Roboto', 'Segoe UI', 'Helvetica', system-ui, sans-serif;
    serif: 'DejaVu Serif', 'Sitka Small', serif;
}
form.classic {
    --label-width: @label-width;
    --form-bg-semitrans: hsl(from var(--bg-lighter) h s l / 0.25);
    background: var(--form-bg-semitrans); border-radius: 5px;
    box-shadow: 3px 3px 3px @panel-shadow; color: @text-dark;
    display: inline-block; padding: 0 0.5rem 0.5rem; position: relative;
    &.shiny {
        @property --angle {
            syntax: '<angle>'; initial-value: 0deg; inherits: false;
        }
        @keyframes spin {
            from { --angle: 0deg; }
            to { --angle: 360deg; }
        }
        &::after {
            animation: 3s spin linear infinite;
            background: conic-gradient(
                from var(--angle), transparent 70%, var(--bg-base)
            );
            border-radius: 5px; content: ''; height: 100%; left: 50%;
            position: absolute; top: 50%; translate: -50% -50%;
            width: 100%; z-index: -1;
        }
        &:focus-within::after {
            background: conic-gradient(
                from var(--angle), transparent 70%, @form-bg-border-focus
            );
        }
        .form-wrapper {
            background: var(--bg-lighter);
        }
    }
    &.narrow, .form-wrapper.narrow {
        --label-width: @label-width-narrow;
    }
    &.wide .form-wrapper, .form-wrapper.wide {
        max-width: unset; --label-width: @label-width-wide;
    }
    & > .alert-info, .form-wrapper > .alert-info, .form-page > .alert-info {
        padding-bottom: @field-row-gap; padding-top: 0.5rem;
    }
    .alert {
        font-family: #fonts[sans]; font-size: @system-font-size;
    }
    .compound-field {
        display: flex; column-gap: @field-col-gap; flex-wrap: wrap;
        position: relative; row-gap: @field-row-gap;
        &:has(.alert-info) {
            margin-top: 2rem;
        }
        &.hide {
            display: none;
        }
        &.right {
            justify-content: right;
        }
        input:not([type=submit]) {
            max-width: @input-max-width-compound !important;
        }
        .alert-info {
            background: var(--bg-dark); border-radius: 5px;
            box-shadow: 3px 3px 3px @panel-shadow;
            left: calc(var(--label-width) + @field-col-gap);
            margin-left: -2px;
            padding: 0.25rem 0.5rem; position: absolute; top: -2rem;
            white-space: nowrap;
        }
        .input-field:not(.hide) .input-field {
            padding-bottom: 0;
        }
    }
    .form-wrapper {
        border-radius: 5px;min-width: @form-min-width; margin: 0;
        padding: 0 1rem @field-row-gap; position: relative;
        &:has(.input-field.floating) .input-button button {
            margin-top: 1rem;
        }
        .form-title {
            font-family: #fonts[sans];
            font-size: @title-font-size; font-weight: @title-font-weight;
            line-height: 1.5rem; margin-left: -2px; text-transform: uppercase;
        }
    }
    .input-field {
        padding: 0.1875rem 0 (@field-row-gap - 0.1875rem);
        position: relative;
        &.fixed {
            align-items: baseline; column-gap: 0.5rem; display: grid;
            grid-template-columns: var(--label-width) min-content min-content;
            grid-template-areas: "label input selector" "blank alert alert";
            justify-items: start; min-width: @field-min-width;
            row-gap: 0.25rem;
            &.collapse:not(.hide) {
                &:not(.input-datastructure) {
                    grid-template-columns:
                        min-content min-content min-content;
                }
            }
            &.expand:not(.hide) {
                &:not(.input-datastructure) {
                    grid-template-columns:
                        @label-width-wide min-content min-content;
                }
            }
            &.shrink:not(.hide) {
                &:not(.input-datastructure) {
                    grid-template-columns:
                        @label-width-narrow min-content min-content;
                }
            }
        }
        &.fixed.label-right {
            grid-template-columns: min-content auto var(--label-width);
            grid-template-areas: "selector input label" "alert alert blank";
            input, select, span, textarea {
                justify-self: end;
            }
        }
        &.floating {
            display: grid; grid-template-columns: 0 min-content min-content;
            grid-template-areas: "label input selector" "blank alert alert";
            justify-content: center; row-gap: 0.25rem;
            input {
                height: 1.75rem; margin-top: 1.25rem; max-width: unset;
                outline: transparent;
                &[type=password], &[type=text]:not(.digit) {
                    border-radius: 50px; padding-left: 0.75rem;
                }
                &.digit:first-child {
                    border-bottom-left-radius: 50px;
                    border-top-left-radius: 50px;
                }
                &.digit:last-child {
                    border-bottom-right-radius: 50px;
                    border-top-right-radius: 50px;
                }
            }
        }
        &.hide {
            display: none !important; opacity: 0;
        }
        &.inline:not(.hide) {
            display: inline-grid !important; margin-right: 0.5rem;
            .input-field {
                padding-bottom: 0;
            }
        }
        &:has(.digit-input-wrapper),
        &:has(input[required=required]),
        &:has(select[required=required]),
        &:has(textarea[required=required]) {
            .field-label::after {
                color: @field-required; content: '*'; min-width: 2ch;
                padding-left: 0.25rem;
            }
        }
        &:has(.digit-input-wrapper > input:valid),
        &:has(input:valid),
        &:has(select:valid),
        &:has(textarea:valid) {
            .field-label::after {
                content: 'â€ˆ';
            }
        }
        &:has(.alert-info.top) {
            grid-template-areas: "blank alert alert" "label input selector";
        }
        &:hover, &:has(input:focus), &:has(input:valid) {
            span.field-label {
                top: -0.25rem;
            }
        }
        span.field-label {
            border: 2px solid transparent; padding: 0.125rem 0.25rem;
            position: absolute; top: 1.3175rem; transition: top 0.5s;
            translate: 0.5rem;
        }
        input, select, textarea {
            border-radius: 5px; font-family: #fonts[serif];
            font-size: @data-font-size; font-weight: @data-font-weight;
            grid-area: input;
            &:focus:not(.digit) {
                outline: 1px solid @field-focus-outline;
            }
        }
        input {
            border: 2px inset @input-border; height: 1.75rem;
            &:focus {
                background: var(--bg-base);
            }
            &[type=date], &[type=email], &[type=password], &[type=text] {
                padding: 0.125rem 0.25rem;
            }
            &[type=file] {
                &::file-selector-button {
                    background: var(--button-bg);
                    border: 2px outset @button-border; border-radius: 50px;
                    color: @text-link; cursor: pointer;
                    font-family: #fonts[sans]; font-size: @button-font-size;
                    font-weight: @button-font-weight; letter-spacing: 0.1rem;
                    line-height: 0.8rem; padding: 0.366rem 0.75rem;
                    text-transform: uppercase;
                }
                &::file-selector-button:hover {
                    color: @text-dark;
                }
            }
            &[readonly=readonly] {
                color: @text-disabled;
            }
            &[readonly=readonly][type=datetime-local]:not(.tile) {
                background: var(--form-bg-semitrans);
                border: 0; color: @text-dark;
            }
            &[type=submit] {
                font-family: #fonts[sans]; font-size: @system-font-size;
            }
            &:not([type=checkbox], [type=submit]) {
                max-width: @input-max-width;
                &:not(.digit) {
                    min-width: @input-min-width;
                }
            }
        }
        select {
            background: var(--button-bg); border: 2px inset @input-border;
            max-width: @select-max-width; min-width: @select-min-width;
            padding: 0.25rem;
            &:not(.select-multiple) option {
                font-family: #fonts[sans]; font-size: @system-font-size;
            }
            &.select-multiple option {
                min-width: @select-option-min-width; padding: 0.125rem;
            }
            &.select-multiple option[selected=selected] {
                background: var(--bg-base);
            }
        }
        textarea {
            box-sizing: content-box; border: 2px inset @input-border;
            min-height: @textarea-min-height; max-width: @textarea-max-width;
            min-width: @textarea-min-width; overflow: auto; padding: 0.25rem;
            &:focus {
                background: var(--bg-base);
            }
        }
        .alert {
            border-radius: 5px; display: block;
            grid-area: alert; max-width: @alert-max-width;
            min-width: @alert-min-width;
            padding: 0.4375rem 0.5rem 0.3175rem;
        }
        .alert-error {
            background: @exception-bg; box-shadow: 3px 3px 3px @panel-shadow;
        }
        .alert-info {
            background: var(--bg-dark); box-shadow: 3px 3px 3px @panel-shadow;
            margin-left: -2px; min-width: 12.5rem;
        }
        .field-label {
            font-family: #fonts[sans]; font-size: @system-font-size;
            grid-area: label; line-height: 1rem; position: relative;
            white-space: nowrap;
            .label-sep-after {
                position: absolute; right: 0.25rem;
            }
        }
    }
    .data-structure, .input-button, .input-selector {
        isolation: isolate;
        a.form-button, button {
            background: var(--button-bg); border: 2px outset @button-border;
            border-radius: 50px; color: @text-link;
            cursor: pointer; display: inline-block; overflow: hidden;
            position: relative; text-decoration: none;
            transition: border 0.5s, color 0.5s;
            &::before {
                background: var(--button-bg-highlight); content: '';
                display: block; height: 3rem; left: var(--x); opacity: 0;
                position: absolute; top: var(--y);
                transform: translate(-50%, -50%); transition: opacity 0.5s;
                width: 3rem; z-index: 1;
            }
            &::after {
                background: var(--button-bg); border-radius: 50px; content: '';
                inset: 3px; position: absolute; z-index: 2;
            }
            &:hover {
                border: 2px inset @button-border; color: @text-dark;
                &::before {
                    opacity: 1;
                }
            }
            span, svg {
                font-family: #fonts[sans]; font-size: @button-font-size;
                font-weight: @button-font-weight; letter-spacing: 0.1rem;
                position: relative; text-decoration: none;
                text-transform: uppercase; white-space: nowrap; z-index: 3;
            }
            span.icon-wrapper {
                display: block;
                svg {
                    vertical-align: top;
                }
            }
        }
        a.form-button {
            padding: 0.0625rem 0.75rem 0.25rem;
        }
        button {
            padding: 0.1875rem 0.75rem 0.3125rem;
            &[disabled=disabled], &[disabled=disabled]::after {
                background: var(--button-bg-disabled);
            }
        }
    }
    .data-structure {
        align-items: flex-start; display: flex; flex-direction: column;
        row-gap: @field-row-gap;
    }
    .digit-input-wrapper {
        display: flex; grid-area: input;
    }
    .ds-form {
        display: flex; flex-direction: column; gap: 0.5rem;
        padding-bottom: (@field-row-gap + 0.25rem); position: relative;
        overscroll-behavior-inline: contain; scroll-behavior: smooth;
        &.horizontal, &.vertical {
            &.snaps-inline > * {
                scroll-snap-align: start;
            }
        }
        &.horizontal {
            flex-direction: row; overflow-x: auto;
            max-width: @ds-form-max-width-horizontal;
            padding-right: 0.25rem;
            &.snaps-inline {
                scroll-snap-type: inline mandatory;
            }
        }
        &.vertical {
            max-height: @ds-form-max-height-vertical; overflow-y: auto;
            padding-right: 0.75rem;
            &.snaps-inline {
                scroll-snap-type: block mandatory;
            }
        }
        .ds-header {
            font-family: #fonts[sans]; font-size: @system-font-size;
            font-weight: normal; padding-top: 0.2rem;
        }
        .ds-row {
            background: var(--bg-base); border-radius: 5px;
            box-shadow: 3px 3px 3px @panel-shadow; display: flex;
            justify-content: space-between; padding: @field-row-gap;
        }
        .ds-field {
            border-radius: 5px; border-bottom-right-radius: 0;
            border-top-right-radius: 0; display: flex; flex-direction: column;
            &.hide {
                display: none;
            }
            img {
                aspect-ratio: 16 / 9; inline-size: 100%; object-fit: contain;
            }
            input[readonly=readonly] {
                background: var(--bg-base) !important;
                font-family: #fonts[sans]; font-size: @system-font-size;
                font-weight: normal;
                &.input-datetime {
                    margin-left: -0.25rem;
                }
            }
        }
        .ds-field-group {
            display: flex;
            &.vertical {
                flex-direction: column;
            }
        }
        .ds-input.input-text[readonly=readonly] {
            background: var(--form-bg-semitrans); border: 0; border-radius: 0;
            color: @text-dark; padding: 0;
        }
        .ds-output {
            box-sizing: content-box; font-size: @system-font-size;
            margin-right: 0.25rem;
        }
        .ds-reorderable {
            margin: auto; padding-left: 0.5rem;
            .knob {
                display: block; height: 20px; width: 20px;
            }
        }
        .ds-reorderable-drag {
            position: absolute;
        }
        .ds-remove {
            border-radius: 5px; border-bottom-left-radius: 0;
            border-top-left-radius: 0; padding: 0.125rem 0 0 0.25rem;
            .ds-remove-icon {
                align-items: center; background: var(--button-bg);
                border-radius: 3px; box-shadow: 2px 2px 2px @panel-shadow;
                color: @text-close; cursor: pointer; display: flex;
                font-family: #fonts[sans]; font-size: @system-font-size;
                font-weight: bold; padding: 0 0.25rem;
                &:hover {
                    box-shadow: inset 0 0 3px @panel-shadow;
                    color: @text-dark;
                }
                img, svg {
                    height: 20px; width: 20px; vertical-align: middle;
                }
            }
        }
        .ds-tag {
            padding-bottom: 0.25rem;
        }
        .ds-tag-label {
            font-family: #fonts[sans]; font-size: @system-font-size;
            margin-right: 0.25rem;
        }
    }
    .input-boolean {
        &:has(.label-checkbox) {
            align-items: center !important;
        }
        &:has(input:focus) .checkbox-wrapper::before {
            outline: 1px solid @field-focus-outline;
        }
        .checkbox-wrapper {
            display: flex; grid-area: input; isolation: isolate;
            padding: 2px 0; position: relative;
            &::before {
                background: @checkbox-bg-false;
                border: 2px inset @button-border; border-radius: 10px;
                content: ''; display: block; position: absolute;
                height: @checkbox-height; left: 0; width: @checkbox-width;
                z-index: 1;
            }
            &::after {
                background: var(--button-bg);
                border: 2px inset @button-border; border-radius: 10px;
                content: ''; display: block; position: absolute;
                height: @checkbox-height; left: 0;
                width: @checkbox-width-knob; z-index: 2;
            }
            &:has(input[type=checkbox]:checked) {
                &::before {
                    background: @checkbox-bg-true;
                }
                &::after {
                    left: @checkbox-width-knob;
                }
            }
            input[type=checkbox] {
                height: @checkbox-height; margin: 0; opacity: 0;
                position: relative; width: @checkbox-width; z-index: 3;
            }
        }
    }
    .input-button {
        align-items: center; display: flex; justify-content: right;
        &.expand {
            padding-left: 2px; padding-right: 2px;
            button {
                flex: 2;
            }
        }
        &.left {
            justify-content: left;
        }
        &.right {
            margin-right: 0 !important; position: absolute; right: 1rem;
        }
    }
    .input-colour {
        align-items: center !important;
    }
    .input-datetime input.tile {
        background: var(--bg-lightest);
        border: 2px inset @input-border; border-radius: 5px;
        color: @text-disabled; font-size: (@data-font-size - 0.0625rem);
    }
    .input-display {
        &:has(img) {
            align-items: flex-start !important;
        }
        span {
            font-family: #fonts[serif]; font-size: @data-font-size;
            grid-area: input; max-width: @display-text-max-width;
            min-width: @display-text-min-width; padding: 0.25rem;
            &.breaking-text {
                white-space: break-spaces;
            }
            &.code {
                white-space: unset;
            }
            &.datetime, &.identity, &.version {
                white-space: nowrap;
            }
            &.tile {
                background: var(--bg-lightest);
                border: 2px inset @input-border; border-radius: 5px;
                color: @text-disabled; min-width: @tile-min-width;
            }
        }
    }
    .input-duration .input-select-integer, .input-interval .input-group,
    .input-repeatable div, .input-time-with-zone .input-group {
        display: inline-block;
    }
    .input-captcha input, .input-integer input, .input-interval input,
    .input-money input, .input-number input {
        line-height: 1.75rem; padding-left: 0.25rem; text-align: right;
    }
    .input-duration .option-label .label-sep-after,
    .input-duration .option-label .label-sep-before,
    .input-hidden:not(.input-error) {
        display: none;
    }
    .input-hidden.input-error {
        display: block; width: 100%;
        .alert-error {
            max-width: @alert-max-width;
        }
    }
    .input-immutable {
        &.documentation {
            .comma {
                color: @text-doc-punc; font-size: 1rem; padding-right: 0.5rem;
            }
            .separator {
                color: @text-doc-punc; font-size: 1rem; padding: 0 0.5rem;
            }
            .start-array, .start-inline-array, .end-array, .end-inline-array,
            .start-object, .start-inline-object, .end-object,
            .end-inline-object {
                color: @text-doc-punc; font-size: @system-font-size;
            }
            .key {
                color: @text-watermark; display: inline-block;
                font-size: 1rem; min-width: 7rem;
            }
            .value {
                display: inline-block; font-family: #fonts[serif];
                font-size: @data-font-size;
            }
            .start-object, .end-object, .end-array, .break {
                display: block;
            }
            .data > .array, .end-inline-object, .inline-entry, .inline-object {
                display: inline-block;
            }
            .data, .object, .start-inline-array .level_2 {
                padding-left: 2rem;
            }
            .start-array {
                padding-right: 0.5rem;
            }
            .start-inline-array, .start-inline-object {
                display: inline-block; padding-right: 0.5rem;
            }
            .end-inline-array {
                display: inline-block; padding-left: 0.5rem;
            }
            .entry:has(> .level_3) > .key {
                min-width: 5rem !important;
            }
            .object:has(.entry > .object .level_3) > .entry .key {
                min-width: 7rem;
            }
        }
        h1, h2, h3, h4, h5 {
            margin: 0.5rem 0;
        }
        a {
            color: @text-link;
        }
        code, p {
            line-height: 1.25rem; max-width: 50rem;
        }
        code {
            font-family: #fonts[mono]; display: inline-block;
            font-size: 0.8rem;
        }
        p {
            font-size: 1rem;
            code {
                font-size: 0.9rem;
            }
        }
        pre {
            white-space: break-spaces;
        }
        p {
            &:has(.start-object) {
                margin-bottom: 0;
            }
        }
    }
    .input-integer {
        .digit {
            border-left: none; border-radius: 0; border-right: none;
            outline: 0; text-align: center; width: 2rem;
            &:first-child {
                border-left: 2px inset @input-border;
                border-bottom-left-radius: 5px; border-top-left-radius: 5px;
            }
            &:last-child {
                border-right: 2px inset @input-border;
                border-bottom-right-radius: 5px; border-top-right-radius: 5px;
            }
        }
    }
    .input-password .reveal {
        cursor: pointer; grid-area: selector;
    }
    .input-select:has(.select-multiple) {
        align-items: flex-start !important;
        label.select-multiple {
            padding-top: 0.4375rem;
        }
    }
    .input-selector button {
        grid-area: selector;
    }
    .input-textarea:has(.field-label) {
        align-items: flex-start !important;
        .field-label {
            padding-top: 0.4375rem;
        }
    }
    .page-list {
        list-style-type: none; margin: 0; padding: @field-row-gap 0;
        li {
            border-bottom: 1px solid @line-border;
            border-top-left-radius: 5px; border-top-right-radius: 5px;
            color: @text-disabled; cursor: pointer; display: inline;
            font-family: #fonts[sans]; font-size: @system-font-size;
            padding: 0.125rem 0.5rem;
            &.selected {
                border: 1px solid @line-border;
                border-bottom: 1px solid transparent;
                color: @text-dark;
            }
        }
    }
    .page-wrapper {
        display: flex; overflow: clip; position: relative;
        .form-page {
            opacity: 1; position: relative; transition: opacity 0.5s;
            &.fade {
                opacity: 0; position: absolute;
            }
            &.hide {
                display: none;
            }
        }
    }
}
.form-error {
    background: @exception-bg; border: 1px solid @line-border;
    border-radius: 5px; box-shadow: 3px 3px 3px @panel-shadow;
    max-width: @error-max-width; overflow: hidden;
    padding: @field-row-gap @field-col-gap;
    h1, h2, h3, h4, h5 {
        margin: 0.5rem 0 !important;
    }
}
.form-messages {
    display: inline-flex; flex-direction: column;
    padding-bottom: @field-row-gap;
    &:empty {
        display: none;
    }
    .alert .card {
        font-family: #fonts[serif]; font-weight: @data-font-weight;
        margin-top: 0.25rem; max-width: @error-max-width;
        padding: 0 0.25rem;
        p {
            margin: 0; max-height: 6rem; overflow: hidden;
            position: relative;
            &.long::after {
                background:
                    linear-gradient(to right, transparent, @exception-bg 80%);
                bottom: 0; content: ''; height: 1rem;
                position: absolute; right: 0; width: 100%;
            }
        }
    }
    .alert-error, .alert-error-message, .alert-severe .card {
        border-radius: 5px; background: @exception-bg;
        box-shadow: 3px 3px 3px @panel-shadow;
        padding: 0.4375rem 0.25rem 0.3175rem;
    }
    .alert-error, .alert-error-message {
        margin-left: -0.25rem;
    }
}
.modal {
    .attachment {
        box-shadow: none;
    }
    .filemanager {
        margin: 0; min-width: @filemanager-min-width;
        .input-field:has(label.field-label) {
            grid-template-columns: auto max-content auto !important;
        }
    }
}
.selector form.classic:not(.wide) {
    box-shadow: none; margin: 0; min-width: @selector-min-width; padding: 0;
}
